---
description: Weights＆BiasesのUIでカスタムチャート機能を使用するチュートリアル
---

# Custom Charts Walkthrough

Weights＆Biasesの組み込みのグラフを超えるには、新しい**カスタムチャート**機能を使用して、パネルに読み込むデータの詳細と、そのデータを視覚化する方法を制御します。

**概要**

1.データをW＆Bに記録します

2.クエリを作成します

3.チャートをカスタマイズします

## 1. 1. W＆Bにデータを記録します

まず、スクリプトにデータを記録します。ハイパーパラメータなど、トレーニングの開始時に設定される単一のポイントにはwandb.configを使用します。時間の経過に伴う複数のポイントにwandb.log（）を使用し、wandb.Table（）を使用してカスタム2D配列をログに記録します。ログに記録されたキーごとに最大10,000のデータポイントをログに記録することをお勧めします。

```python
# Logging a custom table of data
my_custom_data = [[x1, y1, z1], [x2, y2, z2]]
wandb.log({“custom_data_table”: wandb.Table(data=my_custom_data,
                                columns = ["x", "y", "z"])})
```

 [簡単なサンプルノートブック](https://bit.ly/custom-charts-colab)を試してデータ表をログに記録し、次のステップでカスタムチャートを設定します。結果のグラフが[ライブレポート](https://bit.ly/custom-charts-colab)でどのように表示されるかを確認します。

## 2. クエリの作成

 視覚化するデータをログに記録したら、プロジェクトページに移動し、`[+]`ボタンをクリックして新しいパネルを追加し、\[**カスタムチャート**\]を選択します。この[ワークスペース](https://app.wandb.ai/demo-team/custom-charts)でフォローできます。

![A new, blank custom chart ready to be configured](../../../.gitbook/assets/screen-shot-2020-08-28-at-7.41.37-am.png)

### **クエリを追加します**

1. \[概要\]をクリックし、`historyTable`を選択して、実行履歴からデータを取得する新しいクエリを設定します。
2.  **wandb.Table（）**を記録したキーを入力します。上記のコードスニペットでは、my\_custom\_tableでした。[サンプルノートブック](https://bit.ly/custom-charts-colab)では、キーは`pr_curve`とr`oc_curve`です。

###  Vegaフィールドを設定します

クエリがこれらの列に読み込まれるようになったので、Vegaフィールドのドロップダウンメニューで選択するオプションとして使用できます。

![Pulling in columns from the query results to set Vega fields](../../../.gitbook/assets/screen-shot-2020-08-28-at-8.04.39-am.png)

*  **x軸：runSets\_historyTable\_r（リコール）**
*   **y軸：runSets\_historyTable\_p（精度）**
*  **色：runSets\_historyTable\_c（クラスラベル）**

## 3. チャートをカスタマイズします

これでよく把握されたと思いますが、今度は散布図から折れ線グラフへの切り替えについて説明します。\[編集\]をクリックして、この組み込みチャートのVega仕様を変更します。このワークスペースに従ってください。視覚化をカスタマイズするためにVega仕様を更新しました。

* プロット、凡例、x軸、およびy軸のタイトルを追加します（各フィールドに「タイトル」を設定します）
* 「マーク」の値を「ポイント」から「ライン」に変更します
* 使用しない「サイズ」フィールドを削除します**·**    



![](../../../.gitbook/assets/customize-vega-spec-for-pr-curve.png)

これをこのプロジェクトの他の場所で使用できるプリセットとして保存するには、ページの上部にある\[名前を付けて保存\]をクリックします。結果は、ROC曲線とともに次のようになります。  ****

![](https://paper-attachments.dropbox.com/s_5FCA7E5A968820ADD0CD5402B4B0F71ED90882B3AC586103C1A96BF845A0EAC7_1597442868347_Screen+Shot+2020-08-14+at+3.07.30+PM.png)

フォローしてくれてありがとう！質問とフィードバックをCarey氏\([c@wandb.com](mailto:c@wandb.com)\)にメッセージしてください[😊](https://emojipedia.org/smiling-face-with-smiling-eyes/)

##  ボーナス：複合ヒストグラム

ヒストグラムは、数値分布を視覚化して、より大きなデータセットを理解するのに役立ちます。複合ヒストグラムは、同じビン全体の複数の分布を示し、異なるモデル間またはモデル内の異なるクラス間で2つ以上のメトリックを比較できます。運転シーンでオブジェクトを検出するセマンティックセグメンテーションモデルの場合、精度の最適化とユニオンオーバー交差（IOU）の有効性を比較したり、さまざまなモデルが車（データ内の大きくて一般的な領域）と交通標識（はるかに小さく、あまり一般的でない領域）を検出する方法を知りたい場合があります。デモコラボでは、生物の10のクラスのうちの2つの信頼スコアを比較できます。

![](../../../.gitbook/assets/screen-shot-2020-08-28-at-7.19.47-am.png)

カスタム複合ヒストグラムパネルの独自のバージョンを作成する方法：

1. ワークスペースまたはレポートに新しいカスタムチャートパネルを作成します（「カスタムチャート」ビジュアライゼーションを追加します）。右上の\[編集\]ボタンを押して、組み込みのパネルタイプからVega仕様を変更します。
2.  その組み込みのVega仕様を、Vegaの複合ヒストグラムのMVPコードに置き換えます。[Vegaシンタックス](https://vega.github.io/)を使用して、この[Vega仕様でメインタイト](https://gist.github.com/staceysv/9bed36a2c0c2a427365991403611ce21)ル、軸タイトル、入力ドメイン、およびその他の詳細を直接変更できます（色を変更したり、3番目のヒストグラムを追加したりすることもできます :\)
3. 右側のクエリを変更して、wandbログから正しいデータをロードします。フィールド「summaryTable」を追加し、対応する「tableKey」を「class\_scores」に設定して、実行によってログに記録されたwandb.Tableをフェッチします。これにより、ドロップダウンメニューから2つのヒストグラムビンセット（「red\_bins」と「blue\_bins」）に、「class\_scores」としてログに記録されたwandb.Tableの列を入力できます。私の例では、赤いビンには「動物」クラスの予測スコアを選択し、青いビンには「植物」を選択しました。
4. プレビューレンダリングに表示されるプロットに満足するまで、Vegaの仕様とクエリを変更し続けることができます。完了したら、上部にある\[名前を付けて保存\]をクリックし、カスタムプロットに名前を付けて、再利用できるようにします。次に、「パネルライブラリから適用」をクリックしてプロットを終了します。

非常に簡単な実験の結果は次のようになります。1つのエポックで1000の例のみをトレーニングすると、ほとんどの画像が植物ではなく、どの画像が動物であるかについて非常に不確実なモデルが得られます。

![](https://paper-attachments.dropbox.com/s_5FCA7E5A968820ADD0CD5402B4B0F71ED90882B3AC586103C1A96BF845A0EAC7_1598376315319_Screen+Shot+2020-08-25+at+10.24.49+AM.png)

![](https://paper-attachments.dropbox.com/s_5FCA7E5A968820ADD0CD5402B4B0F71ED90882B3AC586103C1A96BF845A0EAC7_1598376160845_Screen+Shot+2020-08-25+at+10.08.11+AM.png)

